{% extends "engine/base.html" %}
{% load static %}

{% block title %}My Tickets - Support{% endblock %}

{% block content %}
<div class="ticket-list-container">
  <div class="ticket-header">
    <h1>My Support Tickets</h1>
    <a href="{% url 'ticket_create' %}" class="btn btn-primary">Report a Bug</a>
  </div>
  
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
  
  <div class="ticket-filters">
    <a href="{% url 'ticket_list' %}" class="filter-btn {% if not status_filter %}active{% endif %}">All</a>
    {% for status_code, status_name in status_choices %}
      <a href="{% url 'ticket_list' %}?status={{ status_code }}" class="filter-btn {% if status_filter == status_code %}active{% endif %}">
        {{ status_name }}
      </a>
    {% endfor %}
  </div>
  
  {% if tickets %}
    <div class="ticket-table">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for ticket in tickets %}
            <tr>
              <td>#{{ ticket.id }}</td>
              <td>{{ ticket.title|truncatewords:10 }}</td>
              <td>
                <span class="status-badge status-{{ ticket.status }}">
                  {{ ticket.get_status_display }}
                </span>
              </td>
              <td>
                <span class="priority-badge priority-{{ ticket.priority }}">
                  {{ ticket.get_priority_display }}
                </span>
              </td>
              <td>{{ ticket.created_at|date:"M d, Y" }}</td>
              <td>
                <a href="{% url 'ticket_detail' ticket.id %}" class="btn btn-sm btn-secondary">View</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <div class="pagination">
      {% if tickets.has_previous %}
        <a href="?page=1{% if status_filter %}&status={{ status_filter }}{% endif %}" class="btn btn-sm">First</a>
        <a href="?page={{ tickets.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="btn btn-sm">Previous</a>
      {% endif %}
      
      <span class="page-info">
        Page {{ tickets.number }} of {{ tickets.paginator.num_pages }}
      </span>
      
      {% if tickets.has_next %}
        <a href="?page={{ tickets.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="btn btn-sm">Next</a>
        <a href="?page={{ tickets.paginator.num_pages }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="btn btn-sm">Last</a>
      {% endif %}
    </div>
  {% else %}
    <div class="empty-state">
      <p>No tickets found.</p>
      <a href="{% url 'ticket_create' %}" class="btn btn-primary">Create Your First Ticket</a>
    </div>
  {% endif %}
</div>

<style>
.ticket-list-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.ticket-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.ticket-header h1 {
  margin: 0;
  color: #1f2937;
  font-size: 32px;
  font-weight: 700;
}

.ticket-filters {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.filter-btn {
  padding: 8px 16px;
  border-radius: 8px;
  text-decoration: none;
  color: #6b7280;
  background: #f3f4f6;
  transition: all 0.2s;
}

.filter-btn:hover {
  background: #e5e7eb;
  color: #374151;
}

.filter-btn.active {
  background: #3b82f6;
  color: white;
}

.ticket-table {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.ticket-table table {
  width: 100%;
  border-collapse: collapse;
}

.ticket-table thead {
  background: #f9fafb;
}

.ticket-table th {
  padding: 15px;
  text-align: left;
  font-weight: 600;
  color: #374151;
  border-bottom: 2px solid #e5e7eb;
}

.ticket-table td {
  padding: 15px;
  border-bottom: 1px solid #f3f4f6;
}

.ticket-table tbody tr:hover {
  background: #f9fafb;
}

.status-badge, .priority-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
}

.status-open {
  background: #dbeafe;
  color: #1e40af;
}

.status-in_progress {
  background: #fef3c7;
  color: #92400e;
}

.status-resolved {
  background: #d1fae5;
  color: #065f46;
}

.status-closed {
  background: #e5e7eb;
  color: #374151;
}

.priority-low {
  background: #f3f4f6;
  color: #6b7280;
}

.priority-medium {
  background: #dbeafe;
  color: #1e40af;
}

.priority-high {
  background: #fef3c7;
  color: #92400e;
}

.priority-urgent {
  background: #fee2e2;
  color: #991b1b;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin-top: 30px;
}

.page-info {
  padding: 0 15px;
  color: #6b7280;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.empty-state p {
  color: #6b7280;
  font-size: 18px;
  margin-bottom: 20px;
}

.btn-sm {
  padding: 6px 12px;
  font-size: 14px;
}

@media (max-width: 768px) {
  .ticket-header {
    flex-direction: column;
    gap: 15px;
    align-items: flex-start;
  }
  
  .ticket-table {
    overflow-x: auto;
  }
  
  .ticket-table table {
    min-width: 600px;
  }
}
</style>
{% endblock %}

